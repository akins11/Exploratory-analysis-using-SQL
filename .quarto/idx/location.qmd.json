{"title":"5. Geo-location Summary","markdown":{"yaml":{"title":"5. Geo-location Summary"},"headingText":"| include: false","containsRefs":false,"markdown":"\n\n<hr>\n\n```{r}\nsource(\"C:/Users/AYOMIDE/Documents/R/R_Projects/eda_SQL/function.R\")\n```\n\n```{r}\n#| message: false\n#| warning: false\n#| include: false\nlibrary(RMariaDB)\nlibrary(DBI)\nlibrary(gt)\nlibrary(gtExtras)\nlibrary(dplyr)\n```\n\n\n```{r}\n#| message: false\n#| warning: false\n#| include: false\nmysqldb <- RMariaDB::dbConnect(\n  RMariaDB::MariaDB(), user =  \"root\", \n  host = \"localhost\",\n  password = Sys.getenv(\"password\"), \n  dbname = \"sales\"\n  )\n```\n\n##### A temporary table containing sales, cost and profit. \n```{sql}\n#| eval: false\nCREATE TEMPORARY TABLE revenue_tbl\n      SELECT store_id,\n             year(order_date) AS order_year,\n             (order_quantity * unit_price) AS sales,\n             ((order_quantity * unit_cost) + ((order_quantity * unit_price) * discount_applied)) AS cost,\n             (order_quantity * unit_price) - ((order_quantity * unit_cost) + ((order_quantity * unit_price) * discount_applied)) AS profit\n        FROM sales_order;\n```\n\n```{r}\n#| echo: false\n#| warning: false\n#| message: false\nquery <- \"\nCREATE TEMPORARY TABLE revenue_tbl\n  \tSELECT store_id,\n           year(order_date) AS order_year,\n           (order_quantity * unit_price) AS sales,\n  \t\t     ((order_quantity * unit_cost) + ((order_quantity * unit_price) * discount_applied)) AS cost,\n  \t\t     (order_quantity * unit_price) - ((order_quantity * unit_cost) + ((order_quantity * unit_price) * discount_applied)) AS profit\n  \t\tFROM sales_order;\n\"\nresults <- dbSendQuery(mysqldb, query)\ndbClearResult(results)\n```\n\n### Total sales, cost and profit By :-\n\n::: {.panel-tabset}\n\n## Region\n```{sql}\n#| eval: false\nSELECT r.region, \n       round(SUM(rt.sales), 2) AS Total_Sales,\n       round(SUM(rt.cost), 2) AS Total_Cost,\n       round(SUM(rt.profit), 2) AS Total_Profit\n  FROM revenue_tbl rt\n  JOIN store s\n  \tON rt.store_id = s.store_id\n  JOIN regions r\n  \tON s.state_code = r.state_code\n  GROUP BY r.region\n  ORDER BY Total_Profit DESC;\n```\n\n```{r}\n#| echo: false\nfetch_res(\n  \"\n  SELECT r.region, \n\t       round(SUM(rt.sales), 2) AS Total_Sales,\n         round(SUM(rt.cost), 2) AS Total_Cost,\n         round(SUM(rt.profit), 2) AS Total_Profit\n  \tFROM revenue_tbl rt\n    JOIN store s\n  \t\tON rt.store_id = s.store_id\n  \tJOIN regions r\n  \t\tON s.state_code = r.state_code\n  \tGROUP BY r.region\n    ORDER BY Total_Profit DESC;\n  \"\n) |>\n  loc_sales_cost_profit_gt()\n```\n\n \nThe highest profit was made in th west region, followed by the South and\nMidwest, while the Northeast Region was where the lowest profit was made.\n\n\n## State \n```{sql}\n#| eval: false\nSELECT s.state, \n       round(SUM(rt.sales), 2) AS Total_Sales,\n       round(SUM(rt.cost), 2) AS Total_Cost,\n       round(SUM(rt.profit), 2) AS Total_Profit\n  FROM revenue_tbl rt\n  JOIN store s\n    ON rt.store_id = s.store_id\n  GROUP BY s.state\n  ORDER BY Total_Profit DESC;\n```\n\n```{r}\n#| echo: false\nfetch_res(\n  \"\n  SELECT s.state, \n\t       round(SUM(rt.sales), 2) AS Total_Sales,\n         round(SUM(rt.cost), 2) AS Total_Cost,\n         round(SUM(rt.profit), 2) AS Total_Profit\n  \tFROM revenue_tbl rt\n       JOIN store s\n  \t\t   ON rt.store_id = s.store_id\n  \tGROUP BY s.state\n    ORDER BY Total_Profit DESC;\n  \"\n) |>\n  loc_sales_cost_profit_gt()\n```\n\n\n## County\n```{sql}\n#| eval: false\nSELECT s.county, \n       round(SUM(rt.sales), 2) AS Total_Sales,\n       round(SUM(rt.cost), 2) AS Total_Cost,\n       round(SUM(rt.profit), 2) AS Total_Profit\n  FROM revenue_tbl rt\n  JOIN store s\n  \tON rt.store_id = s.store_id\n  GROUP BY s.county\n  ORDER BY Total_Profit DESC;\n```\n\n```{r}\n#| echo: false\nfetch_res(\n  \"\n  SELECT s.county, \n\t       round(SUM(rt.sales), 2) AS Total_Sales,\n         round(SUM(rt.cost), 2) AS Total_Cost,\n         round(SUM(rt.profit), 2) AS Total_Profit\n  \tFROM revenue_tbl rt\n    JOIN store s\n  \t\tON rt.store_id = s.store_id\n  \tGROUP BY s.county\n    ORDER BY Total_Profit DESC;\n  \"\n) |>\n  loc_sales_cost_profit_gt()\n```\n\n\n## City\n```{sql}\n#| eval: false\nSELECT s.city_name AS City, \n       round(SUM(rt.sales), 2) AS Total_Sales,\n       round(SUM(rt.cost), 2) AS Total_Cost,\n       round(SUM(rt.profit), 2) AS Total_Profit\n  FROM revenue_tbl rt\n  JOIN store s\n  \tON rt.store_id = s.store_id\n  GROUP BY s.city_name\n  ORDER BY Total_Cost DESC;\n```\n\n```{r}\n#| echo: false\nfetch_res(\n  \"\n  SELECT s.city_name AS City, \n\t       round(SUM(rt.sales), 2) AS Total_Sales,\n         round(SUM(rt.cost), 2) AS Total_Cost,\n         round(SUM(rt.profit), 2) AS Total_Profit\n  \tFROM revenue_tbl rt\n    JOIN store s\n  \t\tON rt.store_id = s.store_id\n  \tGROUP BY s.city_name\n    ORDER BY Total_Cost DESC;\n  \"\n) |>\n  loc_sales_cost_profit_gt()\n```\n\n:::\n\n\n### Top 5 locations with the highest profit:\n\n::: {.panel-tabset}\n\n## overall\n```{sql}\n#| eval: false\nSELECT r.region, s.state, s.county, s.city_name,\n       round(SUM(rt.sales), 2) AS Total_Sales,\n       round(SUM(rt.cost), 2) AS Total_Cost,\n       round(SUM(rt.profit), 2) AS Total_Profit\n  FROM revenue_tbl rt\n  JOIN store s\n  \tON rt.store_id = s.store_id\n  JOIN regions r\n  \tON s.state_code = r.state_code\n  GROUP BY r.region, s.state, s.county, s.city_name\n  ORDER BY Total_Profit DESC\n  LIMIT 5;\n```\n\n```{r}\n#| echo: false\nfetch_res(\n  \"\n  SELECT r.region, s.state, s.county, s.city_name,\n\t       round(SUM(rt.sales), 2) AS Total_Sales,\n         round(SUM(rt.cost), 2) AS Total_Cost,\n         round(SUM(rt.profit), 2) AS Total_Profit\n  \tFROM revenue_tbl rt\n    JOIN store s\n  \t\tON rt.store_id = s.store_id\n  \tJOIN regions r\n  \t\tON s.state_code = r.state_code\n  \tGROUP BY r.region, s.state, s.county, s.city_name\n    ORDER BY Total_Profit DESC\n    LIMIT 5;\n  \"\n) |>\n  cl_name() |>\n  gt() |>\n  fmt_number(columns = 5:7) |>\n  tbl_opts() |>\n  cols_merge(columns = c(Region, State, County, `City Name`),\n             pattern = \"{1} Region, {2} State, {3}<br>{4}\") |>\n  cols_label(Region = \"Location\") |>\n  data_color(columns = 5:6, colors = \"#999999\", apply_to = \"text\") \n```\n\n\n## 2020\n```{sql}\n#| eval: false\nSELECT r.region, s.state, s.county, s.city_name,\n       round(SUM(rt.sales), 2) AS Total_Sales,\n       round(SUM(rt.cost), 2) AS Total_Cost,\n       round(SUM(rt.profit), 2) AS Total_Profit\n  FROM revenue_tbl rt\n  JOIN store s\n  \tON rt.store_id = s.store_id\n  JOIN regions r\n  \tON s.state_code = r.state_code\n  WHERE order_year = 2020\n  GROUP BY r.region, s.state, s.county, s.city_name\n  ORDER BY Total_Profit DESC\n  LIMIT 5;\n```\n\n```{r}\n#| echo: false\nfetch_res(\n  \"\n  SELECT r.region, s.state, s.county, s.city_name,\n\t       round(SUM(rt.sales), 2) AS Total_Sales,\n         round(SUM(rt.cost), 2) AS Total_Cost,\n         round(SUM(rt.profit), 2) AS Total_Profit\n  \tFROM revenue_tbl rt\n    JOIN store s\n  \t\tON rt.store_id = s.store_id\n  \tJOIN regions r\n  \t\tON s.state_code = r.state_code\n    WHERE order_year = 2020\n  \tGROUP BY r.region, s.state, s.county, s.city_name\n    ORDER BY Total_Profit DESC\n    LIMIT 5;\n  \"\n) |>\n  cl_name() |>\n  gt() |>\n  fmt_number(columns = 5:7) |>\n  tbl_opts() |>                       \n  cols_merge(columns = c(Region, State, County, `City Name`),\n             pattern = \"{1} Region, {2} State, {3}<br>{4}\") |>\n  cols_label(Region = \"Location\") |>\n  data_color(columns = 5:6, colors = \"#999999\", apply_to = \"text\") \n```\n\n:::\n\n<h3 class=\"insight-text\">Insight</h3>\n\n<p class=\"insight-summary\">\nIn 2020 The store at Vallejo in Solano County in the state of California within the West region made the most profit for the company. While for all the past years including 2020 Broken Arrow store at Wagoner County in Oklahoma within the Southern region of the country made the most profit.\n<p/>"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":false,"output-file":"location.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.149","editor":"source","theme":["yeti","custom.scss"],"fontcolor":"#18020C","linkcolor":"#0000CD","title":"5. Geo-location Summary"},"extensions":{"book":{"multiFile":true}}}}}